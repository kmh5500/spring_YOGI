<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="question">
    
 <insert id="create" parameterType="QuestionDTO">
    insert into question(qnum, qtype, wname, title, content, phone, passwd, wdate)
	values((select nvl(max(qnum),0)+1 from question), #{qtype}, #{wname}, #{title}, 
			#{content}, #{phone, jdbcType=VARCHAR}, #{passwd}, sysdate)	
 </insert>

 <select id="read" parameterType="int" resultType="QuestionDTO">
	select qnum, qtype, wname, title, content, phone, wdate
	from question
	where qnum = #{qnum}
 </select>
 
 <update id="update" parameterType="QuestionDTO">
	update question
	set title = #{title},
	    content = #{content}, 
	    phone = #{phone, jdbcType=VARCHAR}
	where qnum = #{qnum}
 </update>
 
 <delete id="delete" parameterType="int">
	delete from question
	where qnum = #{qnum}
 </delete>
 
 <select id="list" parameterType="Map" resultType="QuestionDTO">
	select qnum, qtype, wname, title, wdate, r
	from (
	        select qnum, qtype, wname, title, wdate, rownum as r
	        from(
	            select qnum, qtype, wname, title, to_char(wdate, 'yyyy-mm-dd') as wdate
	            from question
	            <where>
	             <choose>
	              <when test="col=='qtype'">
	             	qtype like '%'||#{word}||'%'
	              </when>
	              <when test="col=='wname'">
	             	wname like '%'||#{word}||'%'
	              </when>
	              <when test="col=='title'">
	             	title like '%'||#{word}||'%'
	              </when>
	              <when test="col=='content'">
	             	content like '%'||#{word}||'%'
	              </when>
	              <otherwise>
	             	title like '%'||#{word}||'%'
	             	or
	             	content like '%'||#{word}||'%' 
	              </otherwise>	             
	             </choose>
	            </where>
	            order by qnum desc
	        )
	)
	<![CDATA[
	where r >= #{sno} and r <= #{eno}
	]]>
 </select>
 
 <select id="total" parameterType="Map" resultType="int">
	select count(*) from question
    <where>
     <choose>
      <when test="col=='qtype'">
     	qtype like '%'||#{word}||'%'
      </when>
      <when test="col=='wname'">
     	wname like '%'||#{word}||'%'
      </when>
      <when test="col=='title'">
     	title like '%'||#{word}||'%'
      </when>
      <when test="col=='content'">
     	content like '%'||#{word}||'%'
      </when>
      <otherwise>
     	title like '%'||#{word}||'%'
     	or
     	content like '%'||#{word}||'%' 
      </otherwise>	             
     </choose>
    </where>
 </select>
 
 <select id="checkPasswd" parameterType="Map" resultType="int">
	select count(*) from question
	where qnum = #{qnum} 
	and passwd = #{passwd}
 </select>

</mapper>

