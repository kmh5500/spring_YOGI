<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="booking_room">

 <insert id="create" parameterType="Booking_roomDTO">
	insert into booking_room(bnum, bname, bphone, bhname, brtype, brinfo,
							bperson, bcapacity, bprice, startDate, endDate,
							bcheckIn, bcheckOut, id_FK, rnum_FK)
	values(
	        (select nvl(max(bnum),0)+1 from booking_room),
			#{bname}, #{bphone}, #{bhname}, #{brtype}, #{brinfo},
			#{bperson}, #{bcapacity}, #{bprice}, #{startDate}, #{endDate},
			#{bcheckIn}, #{bcheckOut}, #{id_FK}, #{rnum_FK})
 </insert>
 
 <delete id="delete" parameterType="int">
	delete from booking_room
	where bnum = #{bnum}
 </delete>

 <update id="update" parameterType="Booking_roomDTO">
	update booking_room
	set bname = #{bname},
	    bphone = #{bphone},
	    brtype = #{brtype},
	    brinfo = #{brinfo},
	    bperson = #{bperson},
	    bprice = #{bprice},
	    startDate = #{startDate},
	    endDate = #{endDate},
	    bcheckIn = #{bcheckIn},
	    bcheckOut = #{bcheckOut},
	    bstatus = #{bstatus}
	where bnum = #{bnum}
 </update>
 
 <select id="read" parameterType="int" resultType="Booking_roomDTO">
	select bnum, bname, bphone, bhname, brtype, brinfo, 
			bperson, bcapacity, bprice, startDate, endDate,
			bcheckIn, bcheckOut, bstatus
	from booking_room
	where bnum = #{bnum}
 </select> 
 
 <select id="mlist" parameterType="Map" resultType="Booking_roomDTO">
	<![CDATA[
	select bnum, bhname, brtype, startDate, endDate, bstatus, r
	from (
	        select bnum, bhname, brtype, startDate, endDate, bstatus, rownum r
	        from (
	                select bnum, bhname, brtype, startDate, endDate, bstatus
	                from booking_room
	                where id_FK = #{inId}
	                and endDate >= #{inSdate} 
	                and startDate <= #{inEdate}
	                order by startDate desc, endDate desc
	        )
	) 	
	where r >= #{sno} and r <= #{eno}
	]]>
 </select>
 
 <select id="mtotal" parameterType="Map" resultType="int">
	<![CDATA[
	select count(*) from booking_room
    where id_FK = #{inId}
    and endDate >= #{inSdate} 
    and startDate <= #{inEdate} 
    ]]>
 </select>
 
 <select id="hlist" parameterType="Map" resultType="Booking_roomDTO">	
	select bnum, rnum_FK, brtype, startDate, endDate, bstatus, r
	from (
	        select bnum, rnum_FK, brtype, startDate, endDate, bstatus, rownum r
	        from (
	                select bnum, rnum_FK, brtype, startDate, endDate, bstatus
					from booking_room, hotel				
					where hid = #{sid}
					and bhname = hname
				    <![CDATA[
				    and endDate >= #{inSdate} 
				    and startDate <= #{inEdate}
				    ]]>
				    and rnum_FK = #{inRnum}
				    and brtype = #{inRtype}
				    and bstatus = #{inStatus}
	                order by startDate desc, endDate desc
	        )
	) 	
	<![CDATA[
	where r >= #{sno} and r <= #{eno}
	]]>
 </select>
 
 <select id="htotal" parameterType="Map" resultType="int">
	select count(*) from booking_room, hotel				
	where hid = #{sid}
	and bhname = hname
    <![CDATA[
    and endDate >= #{inSdate} 
    and startDate <= #{inEdate}
    ]]>
    and rnum_FK = #{inRnum}
    and brtype = #{inRtype}
    and bstatus = #{inStatus}
 </select>
 
 <select id="readMember" parameterType="String" resultType="Map">
 	select name, phone, bcnt
 	from member
 	where id = #{id}
 </select>
 
</mapper>