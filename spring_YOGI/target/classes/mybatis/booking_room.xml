<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="booking_room">

 <insert id="create" parameterType="Booking_roomDTO">
	insert into booking_room(bnum, bname, bphone, bhname, brtype, brinfo,
							bperson, bcapacity, bprice, startDate, endDate,
							bcheckIn, bcheckOut, id_FK, rnum_FK)
	values(
	        (select nvl(max(bnum),0)+1 from booking_room),
			#{bname}, #{bphone}, #{bhname}, #{brtype}, #{brinfo},
			#{bperson}, #{bcapacity}, #{bprice}, #{startDate}, #{endDate},
			#{bcheckIn}, #{bcheckOut}, #{id_FK}, #{rnum_FK})
 </insert>
 
 <delete id="delete" parameterType="int">
	delete from booking_room
	where bnum = #{bnum}
 </delete>

 <update id="update" parameterType="Booking_roomDTO">
	update booking_room
	set bname = #{bname},
	    bphone = #{bphone},
	    brtype = #{brtype},
	    brinfo = #{brinfo},
	    bperson = #{bperson},
	    bprice = #{bprice},
	    startDate = #{startDate},
	    endDate = #{endDate},
	    bcheckIn = #{bcheckIn},
	    bcheckOut = #{bcheckOut},
	    bstatus = #{bstatus}
	where bnum = #{bnum}
 </update>
 
 <select id="read" parameterType="int" resultType="Booking_roomDTO">
	select bnum, bname, bphone, bhname, brtype, brinfo, 
			bperson, bcapacity, bprice, startDate, endDate,
			bcheckIn, bcheckOut, bstatus
	from booking_room
	where bnum = #{bnum}
 </select> 
 
 <select id="list" parameterType="Map" resultType="Booking_roomDTO">
 	<![CDATA[
	select bnum, bhname, brtype, startDate, endDate, bstatus, r
	from (
	        select bnum, bhname, brtype, startDate, endDate, bstatus, rownum r
	        from (
	                select bnum, bhname, brtype, startDate, endDate, bstatus
	                from booking_room
	                where id_FK = #{id_FK}
	                and endDate >= #{inSdate} and startDate <= #{inEdate}
	                order by startDate desc, endDate desc
	        )
	)
	where r >= #{sno} and r <= #{eno}
	]]>
 </select>
 
</mapper>